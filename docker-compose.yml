# ===========================================
# AUM.KOHZA.IN - DEPLOYMENT CONFIGURATION
# ===========================================

version: '3.8'

services:
  # Frontend - React App
  frontend:
    build:
      context: ./client
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    environment:
      - VITE_API_URL=https://api.aum.kohza.in
      - VITE_APP_URL=https://aum.kohza.in
      - VITE_APP_DOMAIN=aum.kohza.in
    restart: unless-stopped

  # Backend - Express API
  backend:
    build:
      context: ./server
      dockerfile: Dockerfile
    ports:
      - "3003:3003"
    env_file:
      - ./server/.env.production
    restart: unless-stopped

# ===========================================
# NGINX REVERSE PROXY CONFIG (for reference)
# ===========================================
# 
# server {
#     listen 80;
#     server_name aum.kohza.in;
#     return 301 https://$server_name$request_uri;
# }
#
# server {
#     listen 443 ssl http2;
#     server_name aum.kohza.in;
#
#     ssl_certificate /path/to/cert.pem;
#     ssl_certificate_key /path/to/key.pem;
#
#     location / {
#         proxy_pass http://localhost:3000;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection 'upgrade';
#         proxy_set_header Host $host;
#         proxy_cache_bypass $http_upgrade;
#     }
# }
#
# server {
#     listen 443 ssl http2;
#     server_name api.aum.kohza.in;
#
#     ssl_certificate /path/to/cert.pem;
#     ssl_certificate_key /path/to/key.pem;
#
#     location / {
#         proxy_pass http://localhost:3003;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection 'upgrade';
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_cache_bypass $http_upgrade;
#
#         # For file uploads
#         client_max_body_size 500M;
#     }
# }
